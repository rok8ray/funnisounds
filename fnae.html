<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FNAF - Fixed UI</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', monospace; }
        
        /* Menu Overlay */
        #menu {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: #000; z-index: 2000; color: white;
        }
        #start-btn {
            padding: 20px 40px; font-size: 2em; background: transparent; 
            color: #0f0; border: 2px solid #0f0; cursor: pointer; font-family: inherit;
            display: none; /* Hidden until model loads */
        }
        #start-btn:hover { background: #0f0; color: #000; }

        #loading-text { color: #555; font-size: 1.5em; margin-top: 20px; }

        /* Fixed UI Overlay */
        #ui { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            pointer-events: none; 
            z-index: 10; 
            padding: 20px;
            box-sizing: border-box;
            display: none; /* Hidden until game starts */
        }
        
        .stats { color: #0f0; font-size: 1.5em; text-shadow: 0 0 5px #0f0; }
        
        #clock { 
            position: absolute; 
            top: 20px; 
            right: 40px;
            text-align: right;
            min-width: 150px;
        }

        #power-display {
            position: absolute;
            bottom: 40px;
            left: 40px;
        }

        /* Debug UI */
        #debug-indicator {
            position: absolute;
            top: 60px;
            left: 40px;
            color: #ff0;
            display: none;
        }

        #static-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 100;
            background: url('https://upload.wikimedia.org/wikipedia/commons/0/02/Television_static.gif');
            opacity: 0.05;
        }
        #screen-msg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: none; z-index: 1000; align-items: center; justify-content: center;
            font-size: 5em; font-weight: bold; flex-direction: column; text-align: center;
        }
    </style>
</head>
<body>

    <div id="menu">
        <h1>FIVE NIGHTS AT THE TEMPLE</h1>
        <div id="loading-text">Loading model...</div>
        <button id="start-btn">START GAME</button>
    </div>

    <div id="static-overlay"></div>
    <div id="screen-msg"></div>
    
    <div id="ui">
        <div class="stats" id="power-display">POWER: 100%</div>
        <div class="stats" id="clock">12 AM</div>
        <div class="stats" id="debug-indicator">DEBUG MODE: ON</div>
    </div>

    <script type="importmap">
      { 
         "imports": { 
              "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
              "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
          } 
      }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

        const loader = new GLTFLoader();
        loader.load(
          'https://raw.githubusercontent.com/rok8ray/funnisounds/refs/heads/main/3dmodels/temple.glb',
          (gltf) => {
            window.loadedModel = gltf.scene; 
            document.getElementById('loading-text').style.display = 'none';
            document.getElementById('start-btn').style.display = 'block';
          }
        );

        function startGame() {
            document.getElementById('menu').style.display = 'none';
            document.getElementById('ui').style.display = 'block';

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 2, 5);
            
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            if (window.loadedModel) {
                window.loadedModel.position.set(-1,3,3);
                window.loadedModel.scale.set(10,10,10);
                scene.add(window.loadedModel);
            }
            
            // Adjusted Door Position (-0.5 on X and Z)
            const leftDoor = new THREE.Mesh(new THREE.BoxGeometry(1, 15, 8), new THREE.MeshStandardMaterial({ color: 0x222222 }));
            leftDoor.position.set(-8.9, 15, -1.5); 
            scene.add(leftDoor);

            // Adjusted Enemy Position (-0.5 on X and Z)
            const enemy = new THREE.Mesh(
                new THREE.SphereGeometry(1.5), 
                new THREE.MeshStandardMaterial({color: 0xff0000, roughness: 0.8}) 
            );
            enemy.position.set(-12.5, -2, -15.5); 
            scene.add(enemy);

            // Adjusted Button Positions (-0.5 on X and Z)
            const createBtn = (y, type, color) => {
                const b = new THREE.Mesh(new THREE.BoxGeometry(0.5, 1, 1), new THREE.MeshStandardMaterial({ color, emissive: color, emissiveIntensity: 0.8 }));
                b.position.set(-8.5, y, 3.5); b.userData = { type };
                scene.add(b);
            };
            createBtn(1, "doorL", 0xff0000);   
            createBtn(-1, "lightL", 0xffffff); 

            scene.add(new THREE.AmbientLight(0xffffff, 0.5));
            // Adjusted Panel/Light Position (-0.5 on X and Z)
            const hallwayL = new THREE.PointLight(0xffffff, 0, 50);
            hallwayL.position.set(-10.5, 2, -1.5); 
            scene.add(hallwayL);

            // --- GAME LOGIC ---
            let mouseX = 0, power = 100, leftOpen = true, isGameOver = false, hour = 0, time = 0;
            let enemyActive = false;
            let targetZ = -15.5; // Offset target for logic consistency
            let debugMode = false;

            window.addEventListener('mousemove', (e) => mouseX = (e.clientX / window.innerWidth) * 2 - 1);
            
            window.addEventListener('keydown', (e) => {
                if (e.key.toLowerCase() === 'd') {
                    debugMode = !debugMode;
                    document.getElementById('debug-indicator').style.display = debugMode ? 'block' : 'none';
                }
            });

            window.addEventListener('mousedown', (e) => {
                const mouse = new THREE.Vector2((e.clientX/innerWidth)*2-1, -(e.clientY/innerHeight)*2+1);
                const raycaster = new THREE.Raycaster();
                raycaster.setFromCamera(mouse, camera);
                const hits = raycaster.intersectObjects(scene.children);
                hits.forEach(h => {
                    if(h.object.userData.type === "doorL") leftOpen = !leftOpen;
                    if(h.object.userData.type === "lightL") hallwayL.intensity = hallwayL.intensity ? 0 : 800;
                });
            });

            function endGame(msg, color) {
                isGameOver = true;
                const el = document.getElementById('screen-msg');
                el.innerHTML = msg; el.style.backgroundColor = color;
                el.style.color = "white"; el.style.display = 'flex';
            }

            function animate() {
                if (isGameOver) return;
                requestAnimationFrame(animate);

                camera.rotation.y += (-mouseX * 1.5 - camera.rotation.y) * 0.05;
                leftDoor.position.y = THREE.MathUtils.lerp(leftDoor.position.y, leftOpen ? 15 : 0, 0.1);

                time += 1/60; 
                if(time >= 40) { time = 0; hour++; 
                    document.getElementById('clock').innerText = (hour === 0 ? 12 : hour) + " AM";
                    if(hour === 6) endGame("6 AM<br>YOU WIN", "blue");
                }

                if (!debugMode) {
                    power -= (0.005 + (!leftOpen ? 0.08 : 0) + (hallwayL.intensity ? 0.04 : 0));
                }
                
                document.getElementById('power-display').innerText = `POWER: ${Math.max(0, Math.floor(power))}%`;
                
                if (power <= 0 && !debugMode) endGame("POWER OUTAGE", "black");

                if (Math.random() > 0.998 && !enemyActive) {
                    enemyActive = true;
                    targetZ = -1.5; // Adjusted attack threshold
                }

                enemy.position.z = THREE.MathUtils.lerp(enemy.position.z, targetZ, 0.02);

                if (enemyActive && enemy.position.z > -2.5 && leftOpen && Math.random() > 0.99) {
                    if (!debugMode) {
                        endGame("GAME OVER", "red");
                    }
                }

                if (!leftOpen && enemyActive && enemy.position.z > -3.5) {
                    targetZ = -15.5;
                    if (enemy.position.z < -14.5) {
                        enemyActive = false;
                    }
                }

                renderer.render(scene, camera);
            }
            animate();
        }

        document.getElementById('start-btn').addEventListener('click', startGame);

    </script>
</body>
</html>
