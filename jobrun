<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAREER STALKER 3D</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', Courier, monospace; }
        
        /* UI Overlay */
        #ui {
            position: absolute; top: 20px; left: 20px; color: #0f0; 
            text-shadow: 2px 2px #000; pointer-events: none; z-index: 5;
        }
        #stamina-container {
            width: 200px; height: 10px; border: 1px solid #0f0; margin-top: 10px;
        }
        #stamina-bar { width: 100%; height: 100%; background: #0f0; }

        /* Start Screen */
        #instructions {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.85); color: white; text-align: center; z-index: 20;
        }
        button {
            padding: 15px 30px; font-size: 18px; cursor: pointer; 
            background: #0f0; border: none; font-family: inherit; font-weight: bold;
        }
        button:hover { background: #0a0; }

        /* Game Over Screen */
        #game-over-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(100, 0, 0, 0.9); color: white; z-index: 30;
        }
        #game-over-screen h1 { font-size: 70px; margin-bottom: 0; }
    </style>
</head>
<body>

    <div id="ui">
        <div>DEBT AVOIDED: <span id="score">0</span>s</div>
        <div id="stamina-container"><div id="stamina-bar"></div></div>
        <div style="font-size: 10px; margin-top: 5px;">[WASD] MOVE | [SHIFT] SPRINT</div>
    </div>

    <div id="instructions">
        <h1>CAREER STALKER</h1>
        <p>Don't let the job application touch you. STAY UNEMPLOYED.</p>
        <button id="start-btn">ACCEPT OFFER (START)</button>
    </div>

    <div id="game-over-screen">
        <h1>YOU'RE HIRED.</h1>
        <p>You survived for <span id="final-score">0</span> seconds before signing.</p>
        <button onclick="location.reload()">TRY TO RESIGN (RESTART)</button>
    </div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // --- SCENE SETUP ---
        const scene = new THREE.Scene();
        scene.fog = new THREE.Fog(0x000000, 5, 25);
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // --- LIGHTING ---
        const ambient = new THREE.AmbientLight(0x404040, 0.5); 
        scene.add(ambient);

        const flashLight = new THREE.SpotLight(0xffffff, 100);
        flashLight.angle = 0.5;
        flashLight.penumbra = 0.3;
        scene.add(flashLight);
        scene.add(flashLight.target);

        // --- WORLD OBJECTS ---
        const grid = new THREE.GridHelper(500, 100, 0x00ff00, 0x222222);
        scene.add(grid);

        // Player (Green Cube)
        const player = new THREE.Mesh(
            new THREE.BoxGeometry(0.6, 1.2, 0.6),
            new THREE.MeshStandardMaterial({ color: 0x00ff00 })
        );
        player.position.y = 0.6;
        scene.add(player);

        // Chaser (The Job Application)
        const loader = new THREE.TextureLoader();
        const chaserMat = new THREE.MeshStandardMaterial({ 
            map: loader.load('https://eforms.com/images/2018/03/Employment-Job-Application-791x1024.png'),
            transparent: true,
            side: THREE.DoubleSide
        });
        const chaser = new THREE.Mesh(new THREE.PlaneGeometry(2, 2.6), chaserMat);
        chaser.position.set(15, 1.3, 15);
        scene.add(chaser);

        // --- GAME LOGIC ---
        let isLocked = false;
        let isDead = false;
        let stamina = 100;
        let score = 0;
        let yaw = 0;
        let chaserSpeed = 0.08;
        const keys = {};

        const startBtn = document.getElementById('start-btn');
        const instructions = document.getElementById('instructions');
        const gameOverScreen = document.getElementById('game-over-screen');

        // Mouse Lock
        startBtn.addEventListener('click', () => document.body.requestPointerLock());
        
        document.addEventListener('pointerlockchange', () => {
            isLocked = document.pointerLockElement === document.body;
            if (!isDead) instructions.style.display = isLocked ? 'none' : 'flex';
        });

        window.addEventListener('keydown', (e) => keys[e.code] = true);
        window.addEventListener('keyup', (e) => keys[e.code] = false);
        document.addEventListener('mousemove', (e) => {
            if (isLocked && !isDead) yaw -= e.movementX * 0.002;
        });

        function animate() {
            requestAnimationFrame(animate);

            if (isLocked && !isDead) {
                // 1. Scoring & Difficulty
                score += 1/60;
                chaserSpeed += 0.00002;
                document.getElementById('score').innerText = Math.floor(score);

                // 2. Stamina & Speed
                let currentSpeed = 0.12;
                if (keys['ShiftLeft'] && stamina > 1) {
                    currentSpeed = 0.22;
                    stamina -= 0.5;
                } else {
                    if (stamina < 100) stamina += 0.2;
                }
                document.getElementById('stamina-bar').style.width = stamina + '%';

                // 3. Player Movement
                player.rotation.y = yaw;
                const moveVec = new THREE.Vector3();
                if (keys['KeyW']) moveVec.z -= 1;
                if (keys['KeyS']) moveVec.z += 1;
                if (keys['KeyA']) moveVec.x -= 1;
                if (keys['KeyD']) moveVec.x += 1;
                
                moveVec.normalize().applyAxisAngle(new THREE.Vector3(0, 1, 0), yaw);
                player.position.addScaledVector(moveVec, currentSpeed);

                // 4. Camera Follow (3rd Person)
                const camOffset = new THREE.Vector3(0, 3, 6).applyAxisAngle(new THREE.Vector3(0, 1, 0), yaw);
                camera.position.lerp(player.position.clone().add(camOffset), 0.1);
                camera.lookAt(player.position);

                // 5. Flashlight follow
                flashLight.position.copy(player.position).y += 1.5;
                const targetOffset = new THREE.Vector3(0, 0, -10).applyAxisAngle(new THREE.Vector3(0, 1, 0), yaw);
                flashLight.target.position.copy(player.position).add(targetOffset);

                // 6. Chaser AI
                const toPlayer = new THREE.Vector3().subVectors(player.position, chaser.position);
                toPlayer.y = 0;
                
                // Collision Check
                if (toPlayer.length() < 1.1) {
                    endGame();
                } else {
                    chaser.position.addScaledVector(toPlayer.normalize(), chaserSpeed);
                    chaser.lookAt(player.position.x, 1.3, player.position.z);
                    chaser.position.y = 1.3 + Math.sin(Date.now() * 0.005) * 0.3; // Floating effect
                }
            }

            renderer.render(scene, camera);
        }

        function endGame() {
            isDead = true;
            document.exitPointerLock();
            gameOverScreen.style.display = 'flex';
            document.getElementById('final-score').innerText = Math.floor(score);
            
            // Dramatic Death Zoom
            camera.position.set(chaser.position.x, chaser.position.y + 1, chaser.position.z + 3);
            camera.lookAt(chaser.position);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>

